---
title: "Simulate Application Issue"
date: 2020-04-24T11:16:09-04:00
chapter: false
weight: 3
pre: "<b>3. </b>"
---

In this section we will simulate a performance issue to trigger an alarm notifying our the operations team about the founded issue. In our scenario today we will assume a hypothetical API response SLA of under 6 seconds, if API response takes longer than 6 seconds broader user experience is severely impacted, and our Operations team needs to response to this. 

To detect this response time, we have deployed a canary monitoring using [CloudWatch Synthetics](https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/CloudWatch_Synthetics_Canaries.html) to continuously check the application response time and trigger a CloudWatch alarm when response time is gone above the SLA.  

The resources needed for this section is already deployed along with the cloudformation template of your application in previous section. to proceed with this section, please ensure you have completed Section 2 of this lab.

![Section3 Base Architecture](/Operations/200_Automating_operations_with_playbooks_and_runbooks/Images/section3-testing-canary-alarm-architecture.png)

### 3.1 Sending traffic to Application

In this part of the lab we will be sending multiple concurrent requests to the application to simulate large incoming traffic. This is intended to overwhelm the service, and as time goes, response time to the application will become slower thus, setting of the CloudWatch Alarm that will notify our Operations team via email.

From the cloud9 do the following

Confirm that you have the `test.json` in your working folder that contains this text.

```
{"Name":"Test User","Text":"This Message is a Test!"}
```

Execute below command.

```
ALBURL="< Application Endpoint URL captured from section 2>"
ab -p test.json -T application/json -c 3000 -n 60000000 -v 4 http://$ALBURL/encrypt
```

This command uses Apache Benchmark to send 60000000 requests at 3000 concurrently.

Once you executed this command, you will see the command output gradually from successful 200 response 

![Section3 Succces Screenshot](/Operations/200_Automating_operations_with_playbooks_and_runbooks/Images/section3-success-traffic-requests.png)

To several 504 time out response, this is intended, as we are essentially flooding the API.
The requests we are generating is overwhelming our application triggering the occasional Timeout generated by our Load Balancer.

![Section3 Failure Screenshot](/Operations/200_Automating_operations_with_playbooks_and_runbooks/Images/section3-failure-traffic-requests.png)

Keep the command running in the background and proceed to the next step.

### 3.2 Observing the alarm being triggered.

After approximately 1-3 minutes you should now see an alarm being triggered.
You can check this by going to the Cloudwatch console, and click on the Alarms section on the left menu.
Click on the Alarms called `mysecretword-canary-duation-alarm` that should currently be in an Alarm State.

![Section3 Failure Screenshot](/Operations/200_Automating_operations_with_playbooks_and_runbooks/Images/section3-alarm.png)

Clicking on the Alarm will display the CloudWatch metrics that the alarm is triggering from.
Which is the `Duration` metric emitted by `CloudWatchSynthetics` with CanaryName `mysecretword-canary`
This metric essentially measures how it takes for the canary requests until a response is received by the application. The alarm is triggered whenever the value of the `Duration` metric is above 6 seconds within 1 minute duration.

![Section3 Failure Screenshot](/Operations/200_Automating_operations_with_playbooks_and_runbooks/Images/section3-alarm-detail.png)

### 3.3 Observing the Canary.

Working backwards from the alarm, let's now take a look at the Canary monitoring the API emitting those metrics.

Monitoring application health, can be done from multiple angles, system / applications logs, metrics operating system, and services the application is running on. None of these however will be able to replicate accurately the a point of view from the consumer of your application. 

This is why in this scenario a canary is implemented to regularly call and check the health of the API from it's external endpoint using [ CloudWatch synthetics](https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/CloudWatch_Synthetics_Canaries.html)

To look at the Canary configuration, go to CloudWatch Console, and click on **Synthetics** and **Canaries** on the left menu. Locate and click the Canary called `mysecret-canary` 

![Section3 Canary](/Operations/200_Automating_operations_with_playbooks_and_runbooks/Images/section3-canary.png)

Under **Configuration** tab you can see the Canary configuration a snippet of the Canary Script.
scrolling down to the `requestOptionStep1` variable of the script, you can see that the script is calling the `/encrypt` action of the API via the load balancer endpoint, passing a dummy payload.   

![Section3 Canary](/Operations/200_Automating_operations_with_playbooks_and_runbooks/Images/section3-canary-detail.png)

And under **Monitoring** tab you will be able to see a visualization of the Duration metric that is being used to trigger our alarm.

![Section3 Canary](/Operations/200_Automating_operations_with_playbooks_and_runbooks/Images/section3-canary-monitor.png)

Now that we have successfully triggered the Alarm, you should also see that an email arriving in your mailbox notifying about the Alarm.

![Section3 Email](/Operations/200_Automating_operations_with_playbooks_and_runbooks/Images/section3-email.png)

This concludes **Section 3** of this lab. With this section concluded we have simulated a large incoming traffic to our application API overwhelming the application, causing the API to response slowly and occasionally timed out. 

In a real operational environment, this scenario would trigger an incident notification, alerting the operations team to take action.

So now,let's proceed to the next Section of this lab, where we will be building the Automated playbook to investigate issue in the application. 

{{< prev_next_button link_prev_url="../2_configure_ecs_repository_and_deploy_application_stack/" link_next_url="../4_build_execute_investigative_playbook/" />}}

___
**END OF SECTION 3**
___