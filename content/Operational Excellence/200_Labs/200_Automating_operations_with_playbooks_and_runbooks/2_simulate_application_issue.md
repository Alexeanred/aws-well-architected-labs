---
title: "Simulate Application Issue"
date: 2020-04-24T11:16:09-04:00
chapter: false
weight: 2
pre: "<b>2. </b>"
---

Understanding the health of your workload is essential to performing reliable operations. Establish observability, define metrics and thresholds, and analyze your workload (leveraging appropriate services) to streamline issue detection, enable alerting, and expedite your ability to respond and perform remediation processes.

In this section you will simulate a performance issue with the API. A [CloudWatch Synthetics](https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/CloudWatch_Synthetics_Canaries.html) canary is continuously checking the API response time to detect the simulated issue. If the API takes longer than 6 seconds to respond it is considered an application issue and a CloudWatch alarm will be triggered. A notification email will be sent to the Systems Operator in response. 

#### Actions items in this section :
1. You will run a script that will send large amount of traffic to the API
2. You will observe & confirm the issue through AWS monitoring tools. The following resources had been deployed to perform these actions.

![Section3 Base Architecture](/Operations/200_Automating_operations_with_playbooks_and_runbooks/Images/section3-testing-canary-alarm-architecture.png)

### 2.0 Sending traffic to Application

In this section, you we will be sending multiple concurrent requests to the application to simulate large incoming traffic. This is intended to overwhelm the API, and as time goes, response time to the application will become slower triggering the Canary monitor threshold and CloudWatch Alarm that will notify Operations team via email.

Follow below steps to continue :

1. From the cloud9 terminal, copy, paste and run below command to get into the working script folder

    ```
    cd ~/environment/aws-well-architected-labs/static/Operations/200_Automating_operations_with_playbooks_and_runbooks/Code/scripts/
    ```

2. Confirm that you have the `test.json` in the folder, and it contains this text.

    ```
    {"Name":"Test User","Text":"This Message is a Test!"}
    ```

3. Once that's confirmed go to cloudformation console, and take note of the **OutputApplicationEndpoint** value under Output tab of `walab-ops-sample-application` stack. This is the DNS endpoint of the application ALB.


    ![Section3 Succces Screenshot](/Operations/200_Automating_operations_with_playbooks_and_runbooks/Images/section3-stackoutput.png)


4. Then copy paste and execute below commands replacing the '<OutputApplicationEndpoint>' with the DNS endpoint value you took note before.

    ```
    bash simulate_request.sh '<OutputApplicationEndpoint>'
    ```

    This script utilized [Apache Benchmark](https://httpd.apache.org/docs/2.4/programs/ab.html) to send 60000000 requests at 3000 conccurency. Once you executed this command, you will see the command output gradually from successful 200 response to several 504 time out response, this is intended. The requests generated by the script is overwhelming application API resulting occasional timeout by our Load Balancer. Keep the command running in the background throughout the lab and proceed to the next step.


    ![Section3 Succces Screenshot](/Operations/200_Automating_operations_with_playbooks_and_runbooks/Images/section3-success-traffic-requests.png)

    ![Section3 Failure Screenshot](/Operations/200_Automating_operations_with_playbooks_and_runbooks/Images/section3-failure-traffic-requests.png)


### 2.1 Observing the alarm being triggered.

1. After approximately 6 minutes you will an alarm being triggered, and an email generated to your inbox indicating the CloudWatch alarm has been triggered.

    ![Section3 Email](/Operations/200_Automating_operations_with_playbooks_and_runbooks/Images/section3-email.png)
 
2. Check and confirm the alarm by going to the Cloudwatch console.
3. Click on the Alarms section on the left menu.
4. Click on the Alarms called `mysecretword-canary-duation-alarm`, which should currently be in an Alarm State.

    ![Section3 Failure Screenshot](/Operations/200_Automating_operations_with_playbooks_and_runbooks/Images/section3-alarm.png)

5. Click on the Alarm to display the CloudWatch metrics that the alarm data is based from.
6. The Alarm is based on the `Duration` metric data emitted by the canary monitor named `mysecretword-canary` which is done through CloudWatch Synthetics. This metric essentially measures how long it takes for the canary requests to receive a response from the application. 
7. The alarm is triggered whenever the value of the `Duration` metric is above 6 seconds within 1 minute duration.

    ![Section3 Failure Screenshot](/Operations/200_Automating_operations_with_playbooks_and_runbooks/Images/section3-alarm-detail.png)

8. On the left menu click on **Synthetics** and locate the canary monitor named `mysecretword-canary`.

    ![Section3 Canary](/Operations/200_Automating_operations_with_playbooks_and_runbooks/Images/section3-canary.png)

9. Click on the canary and click on the **Configuration** tab.
10. From here you will see the Canary configuration a snippet of the Canary Script.
11. In the Canary Script section, scroll down to the section that contains `let requestOptionStep1` as shown in the screenshot below.12. This is the configuration that is defined in the script. The configuration will define the Hostname the canary is sending the request to, the path, as well as the payload body. 

    ![Section3 Canary](/Operations/200_Automating_operations_with_playbooks_and_runbooks/Images/section3-canary-detail.png)

13. Click on the **Monitoring** tab
14. From here you will see the visualization of the metrics that the canary monitor generates.
15. Locate the 'Duration' metric that is being used to trigger the cloudwatch alarm.
16. From here you will see the average duration of the canary request to complete. A value above 6000ms signifies that the request has taken more than 6 seconds to receive a response from the application. Indicating a performance issue in the API.  

    ![Section3 Canary](/Operations/200_Automating_operations_with_playbooks_and_runbooks/Images/section3-canary-monitor.png)

## Congratulations ! 

You have now completed the second section of the Lab.

By now you should have a `simulate_request.sh` running in the background, that will simulate large influx of traffic to your API causing it to respond very slowly, and time out occasionally. Along with that, a Cloudwatch Alarm triggering performance issue notification to your System Operator to take action

This concludes **Section 2** of this lab. Click Next step to continue to the next section where we will build an Automated playbook to assist investigation of the issue. 

{{< prev_next_button link_prev_url="../2_configure_ecs_repository_and_deploy_application_stack/" link_next_url="../3_build_execute_investigative_playbook/" />}}

___
**END OF SECTION 2**
___